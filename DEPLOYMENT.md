# Инструкция по деплою на Vercel

## Подготовка базы данных

Vercel не поддерживает SQLite в продакшене, поэтому нужно использовать удаленную PostgreSQL базу данных.

### Вариант 1: Neon (Рекомендуется - бесплатный тариф)

1. Создайте аккаунт на [Neon](https://neon.tech)
2. Создайте новый проект
3. Скопируйте Connection String (формат: `postgresql://user:password@ep-xxx.region.aws.neon.tech/neondb?sslmode=require`)
4. Добавьте его в переменные окружения Vercel как `DATABASE_URL`

### Вариант 2: Vercel Postgres

1. В панели Vercel перейдите в раздел Storage
2. Создайте новую PostgreSQL базу данных
3. Vercel автоматически добавит переменную `DATABASE_URL` в ваши переменные окружения

### Вариант 3: Supabase

1. Создайте проект на [Supabase](https://supabase.com)
2. Перейдите в Settings > Database
3. Скопируйте Connection String (используйте Connection Pooling для лучшей производительности)
4. Добавьте его в переменные окружения Vercel как `DATABASE_URL`

## Настройка переменных окружения в Vercel

1. Перейдите в Settings > Environment Variables вашего проекта на Vercel
2. Добавьте следующие переменные:
   - `DATABASE_URL` - строка подключения к PostgreSQL
   - `SOLANA_RPC_URL` - URL RPC узла Solana (для продакшена: `https://api.mainnet-beta.solana.com`)
   - `METAPLEX_RPC_URL` - URL для Metaplex (обычно тот же что и SOLANA_RPC_URL)
   - Любые другие переменные, необходимые для вашего приложения

## Миграции базы данных

После добавления базы данных и переменных окружения:

1. **Локально** - создайте миграцию:
   ```bash
   npm run db:migrate
   ```

2. **На Vercel** - миграции выполняются автоматически во время сборки благодаря команде `prisma migrate deploy` в `build` скрипте

3. **Запуск seed** (опционально, только один раз):
   ```bash
   npm run db:seed
   ```
   ⚠️ Внимание: запускайте seed только на пустой базе данных!

## Деплой

1. Убедитесь, что все изменения закоммичены в Git
2. Запушьте в репозиторий (GitHub/GitLab/Bitbucket)
3. Подключите репозиторий к Vercel (если еще не подключен)
4. Vercel автоматически запустит сборку и деплой

## Проверка после деплоя

1. Проверьте логи сборки в Vercel Dashboard
2. Убедитесь, что миграции выполнились успешно (проверьте логи)
3. Проверьте работу приложения на production URL

## Устранение проблем

### Ошибка подключения к базе данных
- Проверьте, что `DATABASE_URL` правильно установлен в Vercel
- Убедитесь, что база данных доступна из интернета (не заблокирована firewall)
- Для Neon/Supabase проверьте, что используете правильный connection string с SSL

### Ошибки миграций
- Убедитесь, что локально и на продакшене используется одна и та же версия Prisma
- Проверьте, что все миграции находятся в `prisma/migrations/`
- При необходимости запустите `prisma migrate resolve --applied <migration_name>` для пропуска неудачных миграций

### Prisma Client не генерируется
- Убедитесь, что `postinstall` скрипт работает корректно
- Проверьте, что `prisma generate` выполняется во время сборки

